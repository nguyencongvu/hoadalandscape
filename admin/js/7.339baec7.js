(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{2239:function(t,e,a){"use strict";a("a706")},7757:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-layout",[t.c.canAccessModule(t.collection,t.profile.roles)?n("div",{staticClass:"app-padding bg-white"},[n("q-toolbar",[n("div",{staticClass:"text-center q-my-lg"},[n("div",{staticClass:"bold-font text-h5"},[t._v(t._s(t.c.t("Marketing Analysis"))+"\n                    "),t.loading?n("q-spinner-pie",{staticClass:"q-ml-sm",attrs:{color:"primary"}}):t._e()],1)]),n("q-space"),n("q-input",{ref:"search",staticClass:"q-mr-sm",staticStyle:{width:"33%"},attrs:{autofocus:"",clearable:"","bg-color":"white",dense:"",outlined:"",placeholder:t.c.t("Search")+"..."},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}),n("q-btn",{attrs:{flat:"",round:"",icon:"refresh"},on:{click:function(e){return t.fetch()}}}),t.c.canPrint("marketing",t.profile.roles)?n("q-btn",{staticClass:"orientation-landscape",attrs:{flat:"",round:"",icon:"print"}},[n("q-menu",[n("q-list",{staticStyle:{"min-width":"120px"},attrs:{separator:""}},[n("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(e){return t.print("main_table")}}},[t._v("\n                            "+t._s(t.c.t("Print"))+"\n                        ")]),n("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(e){return t.exportCSV()}}},[t._v("\n                            "+t._s(t.c.t("Export CSV"))+"\n                        ")])],1)],1)],1):t._e(),n("q-select",{staticClass:"text-caption text-uppercase orientation-landscape",attrs:{multiple:"",borderless:"",dense:"","options-dense":"","display-value":"","emit-value":"","map-options":"",options:t.columns,"option-value":"name","options-cover":""},model:{value:t.visibleColumns,callback:function(e){t.visibleColumns=e},expression:"visibleColumns"}})],1)],1):n("div",[n("div",{staticClass:"absolute-center"},[n("q-img",{attrs:{width:"25vw",src:a("5183")}}),n("div",{staticClass:"text-center q-my-lg"},[t._v(t._s(t.c.t("Access Denied")))])],1)]),n("q-separator",{staticClass:"q-mb-sm"}),n("div",{staticClass:"app-padding"},[n("div",{staticClass:"border-untop bg-white"},[n("div",{staticClass:"row q-col-gutter-sm q-px-sm text-white"},[n("div",{staticClass:"col-6 col-md-2"},[n("Number",{attrs:{propNumber:t.marketing.length,propText:t.c.t("Website"),propIcon:"traffic",propColor:"red"}})],1),n("div",{staticClass:"col-6 col-md-2"},[n("Number",{attrs:{propNumber:t.c.sum(t.marketing,"views"),propText:t.c.t("Views"),propIcon:"visibility",propColor:"green"}})],1),n("div",{staticClass:"col-6 col-md-2"},[n("Number",{attrs:{propNumber:t.c.sum(t.marketing,"cta"),propText:t.c.t("Clicks"),propIcon:"mouse",propColor:"green"}})],1),n("div",{staticClass:"col-6 col-md-2"},[n("Number",{attrs:{propNumber:t.c.sum(t.marketing,"cookie"),propText:t.c.t("Guests"),propIcon:"person_search",propColor:"blue"}})],1),n("div",{staticClass:"col-6 col-md-2"},[n("Number",{attrs:{propNumber:t.leads.length,propText:t.c.t("Leads"),propIcon:"contact_mail",propColor:"orange"}})],1)]),n("div",{staticClass:"row q-col-gutter-sm q-py-sm"},[n("div",{staticClass:"col-12 col-md-6"},[n("q-card",{staticClass:"q-ml-sm"},[n("DataTable",{attrs:{propCollection:t.collection,propData:t.fsearch,propColumns:t.columns,propVisibleColumns:t.visibleColumns,propRowKey:"url"},on:{reload:function(e){return t.fetch("marketing")}}}),n("PrintCreator")],1)],1),n("div",{staticClass:"col-12 col-md-6"},[n("q-card",{staticClass:"q-pa-sm q-mr-sm"},[n("div",{staticClass:"row q-col-gutter-sm"},[n("div",{staticClass:"col-12 col-md-9"},[n("ChartFunnel",{attrs:{propType:"funnel",propLegend:t.funnel.legend,propData:t.funnel.data}})],1),n("div",{staticClass:"col-12 col-md-3"},[n("div",{staticClass:"text-bold text-primary text-uppercase"},[t._v(t._s(t.c.t("Conversion"))+" ")]),n("q-input",{staticClass:"q-mt-sm",attrs:{type:"number",dense:"",outlined:t.c.outlined(),label:t.c.t("Ads Expense"),value:"500000",min:"500000",step:"100000"},model:{value:t.expense,callback:function(e){t.expense=e},expression:"expense"}}),n("q-input",{staticClass:"q-mt-sm",attrs:{type:"number",dense:"",outlined:t.c.outlined(),label:t.c.t("Impressions"),min:"1000",value:t.newMax,step:"1000"},scopedSlots:t._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:"calculate"},on:{click:function(e){return t.cal(t.funnel)}}})]},proxy:!0}]),model:{value:t.newMax,callback:function(e){t.newMax=e},expression:"newMax"}}),t.perLead>0?n("div",{staticClass:"q-mt-sm"},[t._v("\n                                    "+t._s(t.c.t("Cost Per Lead"))+": "),n("span",{staticClass:"text-bold text-primary"},[t._v(t._s(t.c.formatCurrency(t.perLead)))])]):t._e()],1)])])],1)])])])],1)},r=[],i=a("c973"),s=a.n(i),o=(a("96cf"),a("4de4"),a("caad"),a("2532"),a("d81d"),a("b0c0"),a("e260"),a("d3b7"),a("e6cf"),a("3ca3"),a("ddb0"),a("13d5"),a("bd4c")),c=a("e19d"),l=a("0d2f"),u=a("1a89"),p=a("2d2e"),m=a("1fdb"),d=a("2c55"),f=a("4ea3"),v=a("f18f"),h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-chart",{staticClass:"chart",attrs:{option:t.option}})},b=[],C=a("9523"),g=a.n(C),w=(a("b680"),a("22b4")),x=a("97ac"),y=a("e275"),k=a("9394"),q=a("2da7"),L=a("ff32"),_=a("5c7f");Object(w["a"])([x["a"],y["a"],k["a"],q["a"],L["a"]]);var T={name:"ChartFunnel",props:{propName:String,propType:String,propLegend:Array,propData:Array},components:{VChart:_["b"]},provide:g()({},_["a"],"light"),data:function(){return{c:this.$common,rootValue:1e3,option:{},chartName:this.propName?this.propName:"Funnel Chart",chartType:this.propType?this.propType:"funnel",chartLegend:this.propLegend?this.propLegend:[],chartData:this.propData?this.propData:[]}},created:function(){this.init()},methods:{init:function(){this.chartLegend=this.propLegend?this.propLegend:["top","middle","bottom"],this.chartData=this.propData?this.propData:[{value:1e3,name:"top"},{value:500,name:"middle"},{value:50,name:"bottom"}],this.initOption()},initOption:function(){var t=this;t.option={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c}"},legend:{data:t.chartLegend},series:[{name:t.chartName,type:t.chartType,data:t.chartData,label:{show:!0,position:"inside",formatter:function(e){var a=(e.value/t.rootValue*100).toFixed(2);return e.name+"\n"+e.value+" ("+a+"%) "}},emphasis:{label:{fontSize:20}}}]}}}},D=T,N=(a("bf44"),a("2877")),S=Object(N["a"])(D,h,b,!1,null,"ca2ae92a",null),Q=S.exports,F={name:"ListAll",components:{TimeRange:c["default"],PrintCreator:l["a"],ViewLayout:u["a"],FilterBy:p["default"],DataTable:m["default"],DataCard:d["a"],Comment:f["a"],Number:v["a"],ChartFunnel:Q},data:function(){return{loading:!1,c:this.$common,api:null,collection:"analytics/marketing",showSearch:!1,text:"",objects:[],webObjects:[],marketing:{},sales:{},contacts:[],selected:{},columns:[],visibleColumns:[],timeFilter:null,viewLayout:"table",filters:[],filterText:"",stats:!0,tab:"2",comments:[],funnel:{},newMax:4e3,expense:5e5,perLead:0}},computed:{profile:function(){return this.$store.state.user.profile},fsearch:function(){var t=this,e=[];if(e=t.marketing,t.timeFilter){var a=t.timeFilter,n=new Date(a.from),r=new Date(a.to);e=e.filter((function(t){return o["b"].isBetweenDates(t.first_date,n,r)}))}t.filterText&&""!=t.filterText&&(e=e.filter((function(e){var a=t.filterText.toLowerCase(),n=e.type?e.type.toLowerCase():"",r=e.status?e.status.toLowerCase():"",i=e.category?e.category.toLowerCase():"",s=e.group?e.group.toLowerCase():"";return n==a||r==a||i==a||s==a})));var i=t.text?t.text.toLowerCase():"";return""==i?e:e.filter((function(t){var e=t.channel?t.channel.toLowerCase():"",a=t.slug?t.slug.toLowerCase():"",n=t.url?t.url.toLowerCase():"";return e.includes(i)||a.includes(i)||n.includes(i)}))},leads:function(){var t=this;return t.contacts?t.contacts.filter((function(t){return"Online"==t.type})):[]}},created:function(){this.init()},methods:{init:function(){var t=this;return s()(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,a.api=new a.$api(a.collection),a.api.setDomain(a.profile.domain),a.newMax=1e3,a.initFilter(),e.next=7,a.fetch();case 7:case"end":return e.stop()}}),e)})))()},initFunnel:function(){var t=this;t.funnel={legend:[t.c.t("Ads"),t.c.t("Views"),t.c.t("Clicks"),t.c.t("Guests"),t.c.t("Leads")],data:[{value:1e3,name:t.c.t("Ads")},{value:t.c.sum(t.marketing,"views"),name:t.c.t("Views")},{value:t.c.sum(t.marketing,"cta"),name:t.c.t("Clicks")},{value:t.c.sum(t.marketing,"cookie"),name:t.c.t("Guests")},{value:t.leads.length,name:t.c.t("Leads")}]}},initWebColumns:function(){var t=this;t.columns=[{name:"url",align:"left",label:t.c.t("Url"),field:function(t){return t.url},sortable:!0},{name:"views",align:"left",label:t.c.t("Views"),field:"views",sortable:!0},{name:"uniques",align:"left",label:t.c.t("Uniques"),field:"cookie",sortable:!0},{name:"actions",align:"left",label:t.c.t("Actions"),field:"cta",sortable:!0}],t.visibleColumns=t.columns.map((function(t){return t.name}))},fetch:function(){var t=this;return s()(regeneratorRuntime.mark((function e(){var a,n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,a.loading=!0,e.next=4,a.api.getAll("analytics/marketing");case 4:return n=e.sent,e.next=7,a.api.getAll("cta");case 7:return r=e.sent,i=[n,r],e.next=11,Promise.all(i);case 11:return a.marketing=n.data.objects,a.sales=r.data.objects,a.contacts=n.data.contacts,console.log(""),a.initWebColumns(),a.initFunnel(),a.loading=!1,e.abrupt("return");case 19:case"end":return e.stop()}}),e)})))()},orm:function(t){var e={};return e.first_date=t.first_date,e.last_date=t.last_date,e.cookie=t.cookie,e.url=t.url,e.os=t.os,e.cta_count=t.cta_count,e.channel=t.channel,e},initFilter:function(){var t=this;t.filters=[]},filterTime:function(t){var e=this;e.timeFilter=t,e.$forceUpdate()},fillViewLayout:function(t){var e=this;e.viewLayout=t.value,e.$forceUpdate()},fillFilter:function(t){var e=this;e.filterText=t,e.$forceUpdate()},fillComment:function(t){var e=this;e.comments=t,e.$forceUpdate()},print:function(t){var e=this.$refs[t];e&&this.c.print(e)},exportCSV:function(){var t=this;t.c.exportCSV(t.fsearch,t.columns,t.collection)},webStats:function(t){var e=this,a=e.webObjects.reduce((function(e,a){return e+a[t]}),0);return a},cookieStats:function(t){var e=this,a=e.objects.reduce((function(e,a){return e+a[t]}),0);return a},cal:function(t){var e=this,a=t.data[0].value,n=e.newMax,r=[];r=t.data.map((function(t){var e=t;return e.name=t.name,e.value=t.value/a*n,e})),t.data=r,e.perLead=e.expense/r[r.length-1].value}}},V=F,A=(a("2239"),a("4d5a")),$=a("068f"),I=a("65c6"),M=a("58a8"),j=a("163c"),O=a("2c91"),P=a("27f9"),R=a("9c40"),U=a("4e73"),B=a("1c1c"),E=a("66e5"),G=a("ddd8"),W=a("eb85"),J=a("9564"),z=a("f09f"),K=a("0016"),H=a("714f"),X=a("eebe"),Y=a.n(X),Z=Object(N["a"])(V,n,r,!1,null,"ae128568",null);e["default"]=Z.exports;Y()(Z,"components",{QLayout:A["a"],QImg:$["a"],QToolbar:I["a"],QBadge:M["a"],QSpinnerPie:j["a"],QSpace:O["a"],QInput:P["a"],QBtn:R["a"],QMenu:U["a"],QList:B["a"],QItem:E["a"],QSelect:G["a"],QSeparator:W["a"],QToggle:J["a"],QCard:z["a"],QIcon:K["a"]}),Y()(Z,"directives",{Ripple:H["a"]})},a706:function(t,e,a){},bf44:function(t,e,a){"use strict";a("ea0e")},ea0e:function(t,e,a){}}]);